﻿@using FoodDeliveryWebApp.ViewModels
@model IEnumerable<CartViewModel>
@{
    ViewData["Title"] = "Cart Product Page";
    ViewData["PageType"] = "CartPage";
    // Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .icon-hover-primary:hover {
        border-color: #3b71ca !important;
        background-color: white !important;
    }

        .icon-hover-primary:hover i {
            color: #3b71ca !important;
        }

    .icon-hover-danger:hover {
        border-color: #dc4c64 !important;
        background-color: white !important;
    }

        .icon-hover-danger:hover i {
            color: #dc4c64 !important;
        }
</style>


@* <div class="container-xxl py-5">
    <div class="container">
    </div>
</div> *@

@* <div class="container-xxl py-5 mt-5"> *@
<div class="container-xxl py-5 mt-5">
        <!-- cart + summary -->
        <section class="bg-light my-5">
            <div class="container">
                <div class="row">
                    <!-- cart -->
                    <div class="col-lg-9">
                        <div class="card border shadow-0">
                            <div class="m-4">
                                <h4 class="card-title mb-4">Your shopping cart</h4>
                                @foreach (var cartItem in Model)
                                {
                                <div class="row gy-3 mb-4 cart-item-container" id="cartItemsContainer">
                                        <div class="col-lg-5">
                                            <div class="me-lg-5">
                                                <div class="d-flex">
                                                    <img src="@cartItem.ImageUrl" alt="@cartItem.Name" class="border rounded me-3" style="width: 96px; height: 96px;" />
                                                    <div class="">
                                                    <a href="#" class="nav-link">@cartItem.Name</a>
                                                        <p class="text-muted">@cartItem.Description</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-sm-9 col-6 d-flex flex-row flex-lg-column flex-xl-row text-nowrap">
                                            <div class="p-2">
                                                <input type="number" class="form-control quantity-input" value="@cartItem.Quantity" style="max-width: 80px;">
                                            </div>
                                            <div class="">
                                                <text class="h6">@cartItem.FormattedTotal</text> <br />
                                                @* <small class="text-muted text-nowrap"> @($"{cartItem.KhmerFormattedTotal}") / per item </small> *@
                                                    @* <small class="text-muted text-nowrap"> @cartItem.FormattedPrice / per item </small> *@

                                                <small class="text-muted text-nowrap price-khr" data-default-price="@cartItem.KhmerPrice">@cartItem.KhmerFormattedTotal / per item</small>
                                                <br />
                                                <small class="text-muted text-nowrap price-usd" data-default-price="@cartItem.USDPrice">@cartItem.FormattedPrice / per item</small>
                                            </div>
                                        </div>
                                        <div class="col-lg col-sm-3 d-flex justify-content-sm-center justify-content-md-start justify-content-lg-center justify-content-xl-end mb-2">
                                            <div class="float-md-end">
                                                <a class="addToCartBtn text-body btn btn btn-light border text-danger icon-hover-danger" href="#" >
                                                    <i class="fa fa-shopping-bag text-primary me-2"></i>Add to Cart
                                                </a>
                                                <a class="removeFromCartBtn text-body btn btn-light border text-danger icon-hover-danger" href="#" style="display: none;">
                                                    <i class="fa fa-shopping-bag text-primary me-2"></i>Remove from Cart
                                                </a>
                                            </div>
                                        </div>

                                    </div>
                                }
                            </div>
                            <div class="border-top pt-4 mx-4 mb-4">
                                <p><i class="fas fa-truck text-muted fa-lg"></i> Free Delivery within 1-2 weeks</p>
                                <p class="text-muted">
                                    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
                                    aliquip
                                </p>
                            </div>
                        </div>
                    </div>
                    <!-- cart -->
                    <!-- summary -->
                    <div class="col-lg-3">
                        <div class="card mb-3 border shadow-0">
                            <div class="card-body">
                                <form>
                                    <div class="form-group">
                                        <label class="form-label">Have coupon?</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control border" name="" placeholder="Coupon code" />
                                            <button class="btn btn-light border">Apply</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="card shadow-0 border">
                            <div class="card-body">
                                @* <div class="d-flex justify-content-between">
                                    <p class="mb-2">Total price:</p>
                                    <p class="mb-2">$329.00</p>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <p class="mb-2">Discount:</p>
                                    <p class="mb-2 text-success">-$60.00</p>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <p class="mb-2">TAX:</p>
                                    <p class="mb-2">$14.00</p>
                                </div>
                                <hr /> *@
                                <div class="d-flex justify-content-between">
                                    <p class="mb-2">Total price (KHR):</p>
                                    <p class="mb-2 price-khr" data-default-price="" id="totalKHR">0៛</p>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <p class="mb-2">Total price (USD):</p>
                                <p class="mb-2 price-usd" id="totalUSD">$0.00</p>
                                </div>
                            

                                <div class="mt-3">
                                    <a href="#" class="btn btn-success w-100 shadow-0 mb-2"> Make Purchase </a>
                                    <a href="#" class="btn btn-light w-100 border mt-2"> Back to shop </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- summary -->
                </div>
            </div>
        </section>
        <!-- cart + summary -->
        @* <section>
            <div class="container my-5">
                <header class="mb-4">
                    <h3>Recommended items</h3>
                </header>

                <div class="row">
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="card px-4 border shadow-0 mb-4 mb-lg-0">
                            <div class="mask px-2" style="height: 50px;">
                                <div class="d-flex justify-content-between">
                                    <h6><span class="badge bg-danger pt-1 mt-3 ms-2">New</span></h6>
                                    <a href="#"><i class="fas fa-heart text-primary fa-lg float-end pt-3 m-2"></i></a>
                                </div>
                            </div>
                            <a href="#" class="">
                                <img src="https://bootstrap-ecommerce.com/bootstrap5-ecommerce/images/items/7.webp" class="card-img-top rounded-2" />
                            </a>
                            <div class="card-body d-flex flex-column pt-3 border-top">
                                <a href="#" class="nav-link">Gaming Headset with Mic</a>
                                <div class="price-wrap mb-2">
                                    <strong class="">$18.95</strong>
                                    <del class="">$24.99</del>
                                </div>
                                <div class="card-footer d-flex align-items-end pt-3 px-0 pb-0 mt-auto">
                                    <a href="#" class="btn btn-outline-primary w-100">Add to cart</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="card px-4 border shadow-0 mb-4 mb-lg-0">
                            <div class="mask px-2" style="height: 50px;">
                                <a href="#"><i class="fas fa-heart text-primary fa-lg float-end pt-3 m-2"></i></a>
                            </div>
                            <a href="#" class="">
                                <img src="https://bootstrap-ecommerce.com/bootstrap5-ecommerce/images/items/5.webp" class="card-img-top rounded-2" />
                            </a>
                            <div class="card-body d-flex flex-column pt-3 border-top">
                                <a href="#" class="nav-link">Apple Watch Series 1 Sport </a>
                                <div class="price-wrap mb-2">
                                    <strong class="">$120.00</strong>
                                </div>
                                <div class="card-footer d-flex align-items-end pt-3 px-0 pb-0 mt-auto">
                                    <a href="#" class="btn btn-outline-primary w-100">Add to cart</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="card px-4 border shadow-0">
                            <div class="mask px-2" style="height: 50px;">
                                <a href="#"><i class="fas fa-heart text-primary fa-lg float-end pt-3 m-2"></i></a>
                            </div>
                            <a href="#" class="">
                                <img src="https://bootstrap-ecommerce.com/bootstrap5-ecommerce/images/items/9.webp" class="card-img-top rounded-2" />
                            </a>
                            <div class="card-body d-flex flex-column pt-3 border-top">
                                <a href="#" class="nav-link">Men's Denim Jeans Shorts</a>
                                <div class="price-wrap mb-2">
                                    <strong class="">$80.50</strong>
                                </div>
                                <div class="card-footer d-flex align-items-end pt-3 px-0 pb-0 mt-auto">
                                    <a href="#" class="btn btn-outline-primary w-100">Add to cart</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-sm-6">
                        <div class="card px-4 border shadow-0">
                            <div class="mask px-2" style="height: 50px;">
                                <a href="#"><i class="fas fa-heart text-primary fa-lg float-end pt-3 m-2"></i></a>
                            </div>
                            <a href="#" class="">
                                <img src="https://bootstrap-ecommerce.com/bootstrap5-ecommerce/images/items/10.webp" class="card-img-top rounded-2" />
                            </a>
                            <div class="card-body d-flex flex-column pt-3 border-top">
                                <a href="#" class="nav-link">Mens T-shirt Cotton Base Layer Slim fit </a>
                                <div class="price-wrap mb-2">
                                    <strong class="">$13.90</strong>
                                </div>
                                <div class="card-footer d-flex align-items-end pt-3 px-0 pb-0 mt-auto">
                                    <a href="#" class="btn btn-outline-primary w-100">Add to cart</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section> *@
    </div>
@* </div> *@

@section Scripts
                                {
    <script type="text/javascript">

        $(document).ready(function () {

            // Function to calculate total price
            function calculateTotalPrice() {
                var totalUSD = 0;
                var totalKHR = 0;

                // Create an array to store updated cart items
                var updatedCartItems = [];

                // Iterate through each cart item and calculate totals
                $('.cart-item-container').each(function () {
                    var quantity = parseInt($(this).find('.quantity-input').val());
                    var priceUSD = parseFloat($(this).find('.price-usd').data('default-price'));
                    var priceKHR = parseFloat($(this).find('.price-khr').data('default-price'));
                    var productId = $(this).data('product-id');

                    var totalItemUSD = quantity * priceUSD;
                    var totalItemKHR = quantity * priceKHR;


                    // Add the updated cart item to the array
                    updatedCartItems.push({
                        productId: productId,
                        quantity: quantity
                    });

                    totalUSD += totalItemUSD;
                    totalKHR += totalItemKHR;
                });

                // Make Ajax call to update the cart items
                $.ajax({
                    url: '/FrontPages/UpdateCartTotal',
                    type: 'POST',
                    data: { cartItems: updatedCartItems },
                    success: function (data) {
                        // Update the total prices
                        totalUSD = data.totalUSD;
                        totalKHR = data.totalKHR;
                        updateTotalPrices(totalUSD, totalKHR);
                    },
                    error: function () {
                        console.error('Error updating cart total.');
                    }
                });
                // updateTotalPrices(totalUSD, totalKHR);
            }

            // Function to update total prices in the UI
            function updateTotalPrices(totalUSD, totalKHR) {
                $('#totalUSD').text('$' + totalUSD.toFixed(2));
                $('#totalKHR').text(totalKHR.toFixed(0) + '៛');
            }

            // Attach event handler to quantity change
            $(document).on('input', '.quantity-input', function () {
                calculateTotalPrice();
            });

            // Call the function to calculate and display total prices
            calculateTotalPrice();

            
            


            // var cartItems = updateCartItems();

            // // Function to render cart items in HTML
            // function renderCartItems(cartItems) {
            //     // Clear existing items
            //     $('#cartItemsContainer').empty();

            //     // Iterate over the cart items and append them to the container
            //     for (var i = 0; i < cartItems.length; i++) {
            //         var cartItemHtml = `
            //                 <div class="col-lg-5">
            //                     <div class="me-lg-5">
            //                         <div class="d-flex">
            //                             <img src="${cartItems[i].imageUrl}" alt="${cartItems[i].name}" class="border rounded me-3" style="width: 96px; height: 96px;" />
            //                             <div class="">
            //                                 <a href="#" class="nav-link">${cartItems[i].name}</a>
            //                                 <p class="text-muted">${cartItems[i].description}</p>
            //                             </div>
            //                         </div>
            //                     </div>
            //                 </div>
            //                 <div class="col-lg-2 col-sm-6 col-6 d-flex flex-row flex-lg-column flex-xl-row text-nowrap">
            //                     <div class="">
            //                         <input type="text" class="form-control" placeholder="${cartItems[i].quantity}">
            //                     </div>
            //                     <div class="">
            //                         <text class="h6">${cartItems[i].formattedTotal}</text> <br />
            //                         <small class="text-muted text-nowrap">${cartItems[i].formattedPrice} / per item</small>
            //                     </div>
            //                 </div>
            //                 <div class="col-lg col-sm-6 d-flex justify-content-sm-center justify-content-md-start justify-content-lg-center justify-content-xl-end mb-2">
            //                     <div class="float-md-end">
            //                         <a href="#!" class="btn btn-light border px-2 icon-hover-primary"><i class="fas fa-heart fa-lg px-1 text-secondary"></i></a>
            //                         <a href="#" class="btn btn-light border text-danger icon-hover-danger"> Remove</a>
            //                     </div>
            //                 </div>
            //             `;

            //         $('#cartItemsContainer').append(cartItemHtml);
            //     }
            // }

            // // Call the function to render cart items
            // renderCartItems(cartItems);

            // function updateCartItems() {
            //     $.ajax({
            //         url: '/FrontPages/GetCartProducts',
            //         type: 'GET',
            //         success: function (data) {
            //             console.log(data);
            //             // Check if data is an array
            //             if (Array.isArray(data)) {
            //                 // Update the UI with the cart items
            //                 if (data.length > 0) {
            //                     // Clear existing items
            //                     $('#cartItemsContainer').empty();

            //                     // Iterate over the cart items using $.each
            //                     $.each(data, function (index, cartItem) {
            //                         // Append each cart item to the container using template literals
            //                         var cartItemHtml = `
            //                         <div class="col-lg-5">
            //                             <div class="me-lg-5">
            //                                 <div class="d-flex">
            //                                     <img src="${cartItem.ImageUrl}" alt="${cartItem.Name}" class="border rounded me-3" style="width: 96px; height: 96px;" />
            //                                     <div class="">
            //                                         <a href="#" class="nav-link">${cartItem.Name}</a>
            //                                         <p class="text-muted">${cartItem.Description}</p>
            //                                     </div>
            //                                 </div>
            //                             </div>
            //                         </div>
            //                         <div class="col-lg-2 col-sm-6 col-6 d-flex flex-row flex-lg-column flex-xl-row text-nowrap">
            //                             <div class="">
            //                                 <input type="text" class="form-control" placeholder="${cartItem.Quantity}">
            //                             </div>
            //                             <div class="">
            //                                 <text class="h6">${cartItem.FormattedTotal}</text> <br />
            //                                 <small class="text-muted text-nowrap">${cartItem.FormattedPrice} / per item</small>
            //                             </div>
            //                         </div>
            //                         <div class="col-lg col-sm-6 d-flex justify-content-sm-center justify-content-md-start justify-content-lg-center justify-content-xl-end mb-2">
            //                             <div class="float-md-end">
            //                                 <a href="#!" class="btn btn-light border px-2 icon-hover-primary"><i class="fas fa-heart fa-lg px-1 text-secondary"></i></a>
            //                                 <a href="#" class="btn btn-light border text-danger icon-hover-danger"> Remove</a>
            //                             </div>
            //                         </div>
            //                     `;

            //                         $('#cartItemsContainer').append(cartItemHtml);
            //                     });
            //                 } else {
            //                     // No items found in the cart
            //                     $('#cartItemsContainer').html('<tr><td colspan="5">No items in the cart</td></tr>');
            //                 }
            //             } else {
            //                 console.error('Invalid data format. Expected an array.');
            //             }
            //         },
            //         error: function () {
            //             console.error('Error fetching cart items.');
            //         }
            //     });
            // }



            // initializeCartState();
            // updateCartItemCount();


            // $('.addToCartBtn').on('click', function () {
            //     var button = $(this);
            //     var productId = $(this).data('product-id');

            //     // Check if user is logged in or not
            //     $.get('/FrontPages/CheckLogin', function (isLoggedIn) {
            //         if (isLoggedIn) {
            //             // User is logged in
            //             // alert('Product added to your cart.');
            //             toastr.success("Product added to your cart.");
            //             console.log(isLoggedIn);
            //             addToCart(productId, button);
            //             updateCartItemCount();
            //             console.log(productId, button);
            //         } else {
            //             // User not logged in
            //             toastr.error("Please log in to add the product to your cart.");
            //             // alert('Please log in to add the product to your cart.');
            //             window.location.href = '/Account/Login';

            //         }
            //     });
            // });

            // // Attach click event to Remove from Cart buttons
            // $('.removeFromCartBtn').on('click', function (isLoggedIn) {
            //     var productId = $(this).data('product-id');
            //     if (isLoggedIn) {
            //         // User is logged in
            //         toastr.success("Product removed from your cart.");
            //         console.log(isLoggedIn);
            //         removeFromCart(productId, $(this));
            //     } else {
            //         // User not logged in
            //         toastr.error("Please log in to add the product to remove your cart.");
            //         // alert('Please log in to add the product to your cart.');
            //         window.location.href = '/Account/Login';

            //     }

            // });

            // function updateCartItemCount() {
            //     $.ajax({
            //         url: '/FrontPages/CountCarts',
            //         type: 'GET',
            //         success: function (data) {
            //             // Check if CartItemCount is present in the response
            //             console.log(data);
            //             if (data && data.cartItemCount !== undefined) {
            //                 // Update the UI with the cart count
            //                 $('#cartItemCountContainer').html(
            //                     `<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            //                         ${data.cartItemCount}
            //                         <span class="visually-hidden">unread messages</span>
            //                     </span>`
            //                 );
            //             } else {
            //                 // No cart found, show 0
            //                 $('#cartItemCountContainer').html(
            //                     `<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
            //                         0
            //                         <span class="visually-hidden">unread messages</span>
            //                     </span>`
            //                 );
            //             }
            //         },
            //         error: function () {
            //             console.error('Error fetching cart count.');
            //         }
            //     });
            // }

            // function addToCart(productId, button) {
            //     $.post('/FrontPages/AddToCart', { productId: productId }, function (data) {
            //         if (data.success) {
            //             // Update button
            //             button.removeClass('addToCartBtn').addClass('removeFromCartbtn').text('Remove from Cart');
            //             console.log(data);
            //         } else {
            //             alert(data.message);
            //         }
            //     });
            // }

            // // Function to remove product from cart
            // function removeFromCart(productId, button) {
            //     $.post('/FrontPages/RemoveFromCart', { productId: productId }, function (data) {
            //         if (data.success) {
            //             // Update button
            //             button.hide();
            //             $('.addToCartBtn[data-product-id="' + productId + '"]').show();
            //         } else {
            //             alert(data.message);
            //         }
            //     });
            // }

            // function initializeCartState() {
            //     $('.addToCartBtn').each(function () {
            //         var productId = $(this).data('product-id');
            //         IsProductInCart(productId); // Call the function to update button visibility
            //     });
            // }


            // function IsProductInCart(productId) {
            //     // Make an AJAX request to check if the product is in the cart
            //     $.get('/FrontPages/IsProductInCart', { productId: productId }, function (isInCart) {
            //         if (isInCart) {
            //             // Product is in the cart, update button accordingly
            //             $('.addToCartBtn[data-product-id="' + productId + '"]').hide();
            //             $('.removeFromCartBtn[data-product-id="' + productId + '"]').show();
            //         } else {
            //             // Product is not in the cart, update button accordingly
            //             $('.addToCartBtn[data-product-id="' + productId + '"]').show();
            //             $('.removeFromCartBtn[data-product-id="' + productId + '"]').hide();
            //         }
            //     });
            // }





        });



    </script>
}